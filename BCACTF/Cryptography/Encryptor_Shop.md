# Description
After realizing how insecure the systems of many companies are (they're always getting hacked), I decided to start offering Encryption as a Service (EaaS).
With such a strong guarantee of security, I'll even give you the source code AND my encrypted super secret flag
# Resources
Server.py
```
from Crypto.Util.number import *

p = getPrime(1024)
q = getPrime(1024)
r = getPrime(1024)
n = p * q
phi = (p - 1) * (q - 1)
e = 65537
d = pow(e, -1, phi)

print("Welcome to the enc-shop!")
print("What can I encrypt for you today?")


for _ in range(3):
    message = input("Enter text to encrypt: ")
    m = bytes_to_long(message.encode())
    c = pow(m, e, n)
    print(f"Here is your encrypted message: {c}")
    print(f"c = {c}")
    print("Here is the public key for your reference:")
    print(f"n = {n}")
    print(f"e = {e}")

print("Thank you for encrypting with us!")
print("In order to guarantee the security of your data, we will now let you view the encrypted flag.")
x=input("Would you like to view it? (yes or no) ")

if x.lower() == "yes":
    with open("flag.txt", "r") as f:
        flag = f.read().strip()
    m = bytes_to_long(flag.encode())
    n = p*r
    c = pow(m, e, n)
    print(f"Here is the encrypted flag: {c}")
    print("Here is the public key for your reference:")
    print(f"n = {n}")
```
# Solution
With the additional variable r, we can find p by finding the GCD (greatest common divisor) of both n and with that we can move on with our decryption

Step 1: Find the gcd
```
from math import gcd
n1 = 20866237402242228797989832001282793776772338003317388961600959138825745279090943740761137882143140693710358972350400531821273897557996084793266273702116064182478331012882272149968358055754355105269338573948779201654023621887553857815113605200045175549017666662951878682192699429285631399947293528366344160943481442605751718729791245237638457398201181231403199806637189116530749929127928922430425452866069968099266086532566923192586972331307259596932730110272996089792372871707317326431855118377710553023799729962647404483554957573143714652472647949555897092189069510566286340253957161582446102886352826371026379220361
n2 = 21294224510355071582680048246048192349127847297524116053310871001745583593613097438462267978612579901285659515932789969338088061559132698810393369036269902216802652687273910028309228349941244584857082957825523040599461723311278076993433497618228346408166110979101494936039741652965273316717647570957272446450174111784810292036795585852130493255350764464754842299322553560626945313757373569582810962306846837302237519707856809753074468966156230331157456139720896366928536528660595880211845807988083787968127442862869879956974739555649897222599708353076141538087234906570879742059992114880626298687066280287215821457943

p = gcd(n1,n2)
```
Step 2:
Do the normal Rsa Decryption
```
from math import gcd
from Crypto.Util.number import *

a = 20866237402242228797989832001282793776772338003317388961600959138825745279090943740761137882143140693710358972350400531821273897557996084793266273702116064182478331012882272149968358055754355105269338573948779201654023621887553857815113605200045175549017666662951878682192699429285631399947293528366344160943481442605751718729791245237638457398201181231403199806637189116530749929127928922430425452866069968099266086532566923192586972331307259596932730110272996089792372871707317326431855118377710553023799729962647404483554957573143714652472647949555897092189069510566286340253957161582446102886352826371026379220361
b = 21294224510355071582680048246048192349127847297524116053310871001745583593613097438462267978612579901285659515932789969338088061559132698810393369036269902216802652687273910028309228349941244584857082957825523040599461723311278076993433497618228346408166110979101494936039741652965273316717647570957272446450174111784810292036795585852130493255350764464754842299322553560626945313757373569582810962306846837302237519707856809753074468966156230331157456139720896366928536528660595880211845807988083787968127442862869879956974739555649897222599708353076141538087234906570879742059992114880626298687066280287215821457943
p = gcd(a,b)


r = a // p
n = a
phi = (p - 1) * (r - 1)
e = 65537
d = pow(e, -1, phi)

print(d)

ct = 1261260083869371896686931213761420062352719372042728340942892784957569575542092960420447706414418612301400965070585325079605351022985779783554361944232100861191812258703456529188575985304373187370174962435895429362932411484019695850066027442793546630619752301937351045679957015237225476663154990508799267406335987784055194692348324821654751570160953725128972218060060661196844167390359876470013127197413915458452805377320066545225600957556223948363572063774739879105664234046484627056488407303432298507916196991614713676376742465080074178793836171107691199427218206996026130371407771425482485295896733042315631294642

flag = pow(ct,d,n)
flag = long_to_bytes(flag)
print(flag)

```
# Flag
bcactf{w0w_@lg3br@_d3in48uth934r}
